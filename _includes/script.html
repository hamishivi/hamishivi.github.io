{% if page.mathjax %}
<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
    processEscapes: true
  },
  options: {
    skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  }
};
</script>
<script defer src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
{% endif %}
<script type="module" src="https://unpkg.com/dark-mode-toggle"></script>
<script>
  // Dark mode toggle handling
  document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.querySelector('dark-mode-toggle');
    const root = document.documentElement;
    
    // Restore saved preference
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) {
      root.setAttribute('data-theme', savedTheme);
      if (toggle) {
        toggle.mode = savedTheme;
      }
    }
    
    // Listen for toggle changes
    if (toggle) {
      toggle.addEventListener('colorschemechange', function(e) {
        const theme = e.detail.colorScheme;
        root.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);
      });
    }
    
    // Toggle for bibliography abstract/bibtex dropdowns
    document.querySelectorAll('.btnId').forEach(function(btn) {
      btn.addEventListener('click', function() {
        var str = this.getAttribute('id');
        var ret = str.split('_');
        var id = ret[1];
        var target = document.getElementById(id);
        if (target) {
          target.style.display = target.style.display === 'none' ? 'block' : 'none';
        }
        this.classList.toggle('dropped');
      });
    });
  });

  // Toggle for year sections with accessibility support
  function toggleArrow(year) {
    const content = document.getElementById(`content-${year}`);
    const arrow = document.getElementById(`arrow-${year}`);
    const button = content.previousElementSibling;

    // Toggle the display of the content
    const isExpanded = content.style.display === 'block';
    content.style.display = isExpanded ? 'none' : 'block';
    
    if (isExpanded) {
      arrow.classList.remove('up');
    } else {
      arrow.classList.add('up');
    }
    
    // Update ARIA state
    if (button) {
      button.setAttribute('aria-expanded', !isExpanded);
    }
  }
</script>
